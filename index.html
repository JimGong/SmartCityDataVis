<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no'/>
	<script src="https://d3js.org/topojson.v1.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>

	<script src='https://api.mapbox.com/mapbox-gl-js/v0.40.0/mapbox-gl.js'></script>
	<link href='https://api.mapbox.com/mapbox-gl-js/v0.40.0/mapbox-gl.css' rel='stylesheet'/>

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>

	<script src='csv2geojson.js'></script>

	<title>TEST</title>

</head>
<body>
	<div id='map' style='width: 100%; height: 700px;'></div>
	<script>

		mapboxgl.accessToken = 'pk.eyJ1IjoibWFnaWNiZWFyNzMwIiwiYSI6ImNqOWdnaThiNTJ1YnEzMm5ycTFtZTRsN2kifQ.mxWSrqZ6eSBBlgv3i7ZxuA';
		
		var map = new mapboxgl.Map({
			container: 'map',
			style: 'mapbox://styles/mapbox/light-v9',
			center: [114.1,22.702053],
			zoom: 6,
		});

		// map.scrollZoom.disable();

		$(document).ready(function() {
			$.ajax({
				type: "GET",
				url: 'data/toll_stations.csv',
				dataType: "text",
				success: function(csvData) {makeGeoJSON(csvData);}
			});
		});

		var stationCount=0;

		function makeGeoJSON(csvData) {
			csv2geojson.csv2geojson(csvData, {
				latfield: 'Lat',
				lonfield: 'Lon',
				delimiter: ','
			}, function(err, data) {
				stationCount++;

				map.on('load', function () {
					map.addLayer({
						'id': 'station',
						'type': 'circle',
						'source': {
							'type': 'geojson',
							'data': data
						},
						// 'layout': {
						// 	"icon-image": "marker-15"
						// },
						'paint': {
							"circle-radius":{
								'base': 20,
								'stops': [[6, 3], [22,180]]
							},
							"circle-color": "#1DC5B3" ,
						}
					});
				});    
			});
		}

		console.log(stationCount);












	</script>
</body>
</html>